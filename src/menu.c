#include <gb/gb.h>
#include "../tile-data/tileset.menu.h"
#include "config.h"
#include "game.h"
#include "menu.h"
#include "text.h"
#include "types.h"

const unsigned char map[] = { 0x02 };

const unsigned char line1[] = " Help Gumdrop find  ";
const unsigned char line2[] = "  web cookies to    ";
const unsigned char line3[] = "  replenish energy  ";

const unsigned char line4[] = "Keep Gumdrop moving ";
const unsigned char line5[] = " as long as you can ";

const unsigned char line6[] = "Level 1";
const unsigned char line7[] = "Level 2";
const unsigned char line8[] = "Level 3";

const unsigned char select[] = "o";
const unsigned char unselect[] = " ";

game_mode_t selected_mode;

const unsigned char white_map[] = {
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
};

void show_menu() {
  UBYTE x, y;
  UBYTE j;

  disable_interrupts();
  DISPLAY_OFF;

  init_text();

  move_win(7, 0);

  set_win_tiles(0, 0, 20, 18, white_map);

  HIDE_SPRITES;
  SHOW_BKG;
  SHOW_WIN;

  DISPLAY_ON;

  for (x = 1; x < 18; x++) {
    printc_win(x, 0, *(line1 + x));
    delay(slow_text_delay);
  }

  for (x = 2; x < 16; x++) {
    printc_win(x, 1, *(line2 + x));
    delay(slow_text_delay);
  }

  for (x = 2; x < 18; x++) {
    printc_win(x, 2, *(line3 + x));
    delay(slow_text_delay);
  }

  for (x = 0; x < 8; x++)
    delay(slow_text_delay);

  for (x = 0; x < 19; x++) {
    printc_win(x, 4, *(line4 + x));
    delay(slow_text_delay);
  }

  for (x = 1; x < 19; x++) {
    printc_win(x, 5, *(line5 + x));
    delay(slow_text_delay);
  }

  for (x = 0; x < 8; x++)
    delay(slow_text_delay);

  prints_win(7, 9, line6);
  prints_win(7, 10, line7);
  prints_win(7, 11, line8);

  selected_mode = LEVEL1;

  enable_interrupts();

  while(TRUE) {
    for (y = 0; y < 3; y++) {
      if (y == selected_mode)
        prints_win(5, y + 9, select);
      else
        prints_win(5, y + 9, unselect);
    }

    waitpadup();
    j = waitpad(J_UP | J_DOWN | J_START | J_SELECT | J_A | J_B);

    if (j & J_UP) {
      if (selected_mode == 0)
        selected_mode = 2;
      else
        selected_mode--;
    } else if (j & J_DOWN) {
      if (selected_mode == 2)
        selected_mode = 0;
      else
        selected_mode++;
    } else if (j & (J_START | J_SELECT | J_A | J_B)) {
      break;
    }
  }

  game_state.game_mode = selected_mode;
}

// vim: ts=2 sw=2
